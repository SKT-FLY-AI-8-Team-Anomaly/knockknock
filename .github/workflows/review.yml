name: Assign Reviewers (All except author)

on:
  pull_request:
    types: [opened, reopened, ready_for_review]

jobs:
  assign-reviewers:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Assign reviewers (exclude author)
        env:
          GH_TOKEN: ${{ secrets.SHL0501TOKEN }}
        run: |
          author="${{ github.event.pull_request.user.login }}"
          pr_number="${{ github.event.pull_request.number }}"
          repo="${{ github.repository }}"

          # Get comma-separated list of reviewers
          reviewers=$(gh api repos/$repo/collaborators \
            --jq "[.[] | select(.login != \"$author\") | .login] | join(\",\")")

          echo "Reviewers list: $reviewers"

          if [ -n "$reviewers" ]; then
            gh pr edit "$pr_number" --repo "$repo" --add-reviewer "$reviewers"
          else
            echo "No reviewers to assign."
          fi
